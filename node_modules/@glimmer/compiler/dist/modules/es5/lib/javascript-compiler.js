var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

import { assert } from '@glimmer/util';
import { Stack, DictSet } from '@glimmer/util';
import { isArgument, isAttribute, isFlushElement } from '@glimmer/wire-format';
export var Block = function () {
    function Block() {
        _classCallCheck(this, Block);

        this.statements = [];
    }

    Block.prototype.push = function push(statement) {
        this.statements.push(statement);
    };

    return Block;
}();
export var InlineBlock = function (_Block) {
    _inherits(InlineBlock, _Block);

    function InlineBlock(table) {
        _classCallCheck(this, InlineBlock);

        var _this = _possibleConstructorReturn(this, _Block.call(this));

        _this.table = table;
        return _this;
    }

    InlineBlock.prototype.toJSON = function toJSON() {
        return {
            statements: this.statements,
            parameters: this.table.slots
        };
    };

    return InlineBlock;
}(Block);
export var NamedBlock = function (_InlineBlock) {
    _inherits(NamedBlock, _InlineBlock);

    function NamedBlock(name, table) {
        _classCallCheck(this, NamedBlock);

        var _this2 = _possibleConstructorReturn(this, _InlineBlock.call(this, table));

        _this2.name = name;
        return _this2;
    }

    return NamedBlock;
}(InlineBlock);
export var TemplateBlock = function (_Block2) {
    _inherits(TemplateBlock, _Block2);

    function TemplateBlock(symbolTable) {
        _classCallCheck(this, TemplateBlock);

        var _this3 = _possibleConstructorReturn(this, _Block2.call(this));

        _this3.symbolTable = symbolTable;
        _this3.type = 'template';
        _this3.yields = new DictSet();
        _this3.named = new DictSet();
        _this3.blocks = [];
        _this3.hasEval = false;
        return _this3;
    }

    TemplateBlock.prototype.push = function push(statement) {
        this.statements.push(statement);
    };

    TemplateBlock.prototype.toJSON = function toJSON() {
        return {
            symbols: this.symbolTable.symbols,
            statements: this.statements,
            hasEval: this.hasEval
        };
    };

    return TemplateBlock;
}(Block);
export var ComponentBlock = function (_Block3) {
    _inherits(ComponentBlock, _Block3);

    function ComponentBlock(tag, table, selfClosing) {
        _classCallCheck(this, ComponentBlock);

        var _this4 = _possibleConstructorReturn(this, _Block3.call(this));

        _this4.tag = tag;
        _this4.table = table;
        _this4.selfClosing = selfClosing;
        _this4.attributes = [];
        _this4.arguments = [];
        _this4.inParams = true;
        _this4.positionals = [];
        _this4.blocks = [];
        return _this4;
    }

    ComponentBlock.prototype.push = function push(statement) {
        if (this.inParams) {
            if (isFlushElement(statement)) {
                this.inParams = false;
            } else if (isArgument(statement)) {
                this.arguments.push(statement);
            } else if (isAttribute(statement)) {
                this.attributes.push(statement);
            } else {
                throw new Error('Compile Error: only parameters allowed before flush-element');
            }
        } else {
            this.statements.push(statement);
        }
    };

    ComponentBlock.prototype.pushBlock = function pushBlock(name, block) {
        this.blocks.push([name, block]);
    };

    ComponentBlock.prototype.toJSON = function toJSON() {
        var blocks = void 0;
        var args = this.arguments;
        var keys = args.map(function (arg) {
            return arg[1];
        });
        var values = args.map(function (arg) {
            return arg[2];
        });
        if (this.selfClosing) {
            blocks = null;
        } else if (this.blocks.length > 0) {
            var _keys = [];
            var _values = [];
            for (var i = 0; i < this.blocks.length; i++) {
                var _blocks$i = this.blocks[i],
                    key = _blocks$i[0],
                    value = _blocks$i[1];

                _keys.push(key.slice(1));
                _values.push(value);
            }
            blocks = [_keys, _values];
        } else {
            blocks = [['default'], [{
                statements: this.statements,
                parameters: this.table.slots
            }]];
        }
        return [this.tag, this.attributes, [keys, values], blocks];
    };

    return ComponentBlock;
}(Block);
export var Template = function () {
    function Template(symbols) {
        _classCallCheck(this, Template);

        this.block = new TemplateBlock(symbols);
    }

    Template.prototype.toJSON = function toJSON() {
        return this.block.toJSON();
    };

    return Template;
}();

var JavaScriptCompiler = function () {
    function JavaScriptCompiler(opcodes, symbols, options) {
        _classCallCheck(this, JavaScriptCompiler);

        this.blocks = new Stack();
        this.values = [];
        this.opcodes = opcodes;
        this.template = new Template(symbols);
        this.options = options;
    }

    JavaScriptCompiler.process = function process(opcodes, symbols, options) {
        var compiler = new JavaScriptCompiler(opcodes, symbols, options);
        return compiler.process();
    };

    JavaScriptCompiler.prototype.process = function process() {
        var _this5 = this;

        this.opcodes.forEach(function (op) {
            var opcode = op[0];
            var arg = op[1];
            if (!_this5[opcode]) {
                throw new Error('unimplemented ' + opcode + ' on JavaScriptCompiler');
            }
            _this5[opcode](arg);
        });
        return this.template;
    };
    /// Nesting


    JavaScriptCompiler.prototype.startBlock = function startBlock(program) {
        this.startInlineBlock(program.symbols);
    };

    JavaScriptCompiler.prototype.endBlock = function endBlock() {
        var block = this.endInlineBlock();
        this.template.block.blocks.push(block);
    };

    JavaScriptCompiler.prototype.startProgram = function startProgram() {
        this.blocks.push(this.template.block);
    };

    JavaScriptCompiler.prototype.endProgram = function endProgram() {};
    /// Statements


    JavaScriptCompiler.prototype.text = function text(content) {
        this.push([0 /* Text */, content]);
    };

    JavaScriptCompiler.prototype.append = function append(trusted) {
        this.push([1 /* Append */, this.popValue(), trusted]);
    };

    JavaScriptCompiler.prototype.comment = function comment(value) {
        this.push([2 /* Comment */, value]);
    };

    JavaScriptCompiler.prototype.modifier = function modifier(name) {
        var params = this.popValue();
        var hash = this.popValue();
        this.push([3 /* Modifier */, name, params, hash]);
    };

    JavaScriptCompiler.prototype.block = function block(_ref) {
        var name = _ref[0],
            template = _ref[1],
            inverse = _ref[2];

        var params = this.popValue();
        var hash = this.popValue();
        var blocks = this.template.block.blocks;
        false && assert(typeof template !== 'number' || blocks[template] !== null, 'missing block in the compiler');
        false && assert(typeof inverse !== 'number' || blocks[inverse] !== null, 'missing block in the compiler');

        var namedBlocks = void 0;
        if (template === null && inverse === null) {
            namedBlocks = null;
        } else if (inverse === null) {
            namedBlocks = [['default'], [blocks[template]]];
        } else {
            namedBlocks = [['default', 'else'], [blocks[template], blocks[inverse]]];
        }
        this.push([4 /* Block */, name, params, hash, namedBlocks]);
    };

    JavaScriptCompiler.prototype.openComponent = function openComponent(element) {
        var tag = this.options && this.options.customizeComponentName ? this.options.customizeComponentName(element.tag) : element.tag;
        var component = new ComponentBlock(tag, element.symbols, element.selfClosing);
        this.blocks.push(component);
    };

    JavaScriptCompiler.prototype.openNamedBlock = function openNamedBlock(element) {
        var block = new NamedBlock(element.tag, element.symbols);
        this.blocks.push(block);
    };

    JavaScriptCompiler.prototype.openElement = function openElement(_ref2) {
        var element = _ref2[0],
            simple = _ref2[1];

        var tag = element.tag;
        if (element.blockParams.length > 0) {
            throw new Error('Compile Error: <' + element.tag + '> is not a component and doesn\'t support block parameters');
        } else {
            this.push([7 /* OpenElement */, tag, simple]);
        }
    };

    JavaScriptCompiler.prototype.flushElement = function flushElement() {
        this.push([9 /* FlushElement */]);
    };

    JavaScriptCompiler.prototype.closeComponent = function closeComponent(_element) {
        var _endComponent = this.endComponent(),
            tag = _endComponent[0],
            attrs = _endComponent[1],
            args = _endComponent[2],
            blocks = _endComponent[3];

        this.push([5 /* Component */, tag, attrs, args, blocks]);
    };

    JavaScriptCompiler.prototype.closeNamedBlock = function closeNamedBlock(_element) {
        var blocks = this.blocks;

        var block = blocks.pop();
        this.currentComponent.pushBlock(block.name, block.toJSON());
    };

    JavaScriptCompiler.prototype.closeDynamicComponent = function closeDynamicComponent(_element) {
        var _endComponent2 = this.endComponent(),
            attrs = _endComponent2[1],
            args = _endComponent2[2],
            block = _endComponent2[3];

        this.push([6 /* DynamicComponent */, this.popValue(), attrs, args, block]);
    };

    JavaScriptCompiler.prototype.closeElement = function closeElement(_element) {
        this.push([10 /* CloseElement */]);
    };

    JavaScriptCompiler.prototype.staticAttr = function staticAttr(_ref3) {
        var name = _ref3[0],
            namespace = _ref3[1];

        var value = this.popValue();
        this.push([11 /* StaticAttr */, name, value, namespace]);
    };

    JavaScriptCompiler.prototype.dynamicAttr = function dynamicAttr(_ref4) {
        var name = _ref4[0],
            namespace = _ref4[1];

        var value = this.popValue();
        this.push([12 /* DynamicAttr */, name, value, namespace]);
    };

    JavaScriptCompiler.prototype.componentAttr = function componentAttr(_ref5) {
        var name = _ref5[0],
            namespace = _ref5[1];

        var value = this.popValue();
        this.push([13 /* ComponentAttr */, name, value, namespace]);
    };

    JavaScriptCompiler.prototype.trustingAttr = function trustingAttr(_ref6) {
        var name = _ref6[0],
            namespace = _ref6[1];

        var value = this.popValue();
        this.push([19 /* TrustingDynamicAttr */, name, value, namespace]);
    };

    JavaScriptCompiler.prototype.trustingComponentAttr = function trustingComponentAttr(_ref7) {
        var name = _ref7[0],
            namespace = _ref7[1];

        var value = this.popValue();
        this.push([20 /* TrustingComponentAttr */, name, value, namespace]);
    };

    JavaScriptCompiler.prototype.staticArg = function staticArg(name) {
        var value = this.popValue();
        this.push([18 /* StaticArg */, name, value]);
    };

    JavaScriptCompiler.prototype.dynamicArg = function dynamicArg(name) {
        var value = this.popValue();
        this.push([17 /* DynamicArg */, name, value]);
    };

    JavaScriptCompiler.prototype.yield = function _yield(to) {
        var params = this.popValue();
        this.push([15 /* Yield */, to, params]);
    };

    JavaScriptCompiler.prototype.attrSplat = function attrSplat(to) {
        // consume (and disregard) the value pushed for the
        // ...attributes attribute
        this.popValue();
        this.push([14 /* AttrSplat */, to]);
    };

    JavaScriptCompiler.prototype.debugger = function _debugger(evalInfo) {
        this.push([21 /* Debugger */, evalInfo]);
        this.template.block.hasEval = true;
    };

    JavaScriptCompiler.prototype.hasBlock = function hasBlock(name) {
        this.pushValue([26 /* HasBlock */, name]);
    };

    JavaScriptCompiler.prototype.hasBlockParams = function hasBlockParams(name) {
        this.pushValue([27 /* HasBlockParams */, name]);
    };

    JavaScriptCompiler.prototype.partial = function partial(evalInfo) {
        var params = this.popValue();
        this.push([16 /* Partial */, params[0], evalInfo]);
        this.template.block.hasEval = true;
    };
    /// Expressions


    JavaScriptCompiler.prototype.literal = function literal(value) {
        if (value === undefined) {
            this.pushValue([28 /* Undefined */]);
        } else {
            this.pushValue(value);
        }
    };

    JavaScriptCompiler.prototype.unknown = function unknown(name) {
        this.pushValue([23 /* Unknown */, name]);
    };

    JavaScriptCompiler.prototype.get = function get(_ref8) {
        var head = _ref8[0],
            path = _ref8[1];

        this.pushValue([24 /* Get */, head, path]);
    };

    JavaScriptCompiler.prototype.maybeLocal = function maybeLocal(path) {
        this.pushValue([25 /* MaybeLocal */, path]);
    };

    JavaScriptCompiler.prototype.concat = function concat() {
        this.pushValue([30 /* Concat */, this.popValue()]);
    };

    JavaScriptCompiler.prototype.helper = function helper(name) {
        var params = this.popValue();
        var hash = this.popValue();
        this.pushValue([29 /* Helper */, name, params, hash]);
    };
    /// Stack Management Opcodes


    JavaScriptCompiler.prototype.prepareArray = function prepareArray(size) {
        var values = [];
        for (var i = 0; i < size; i++) {
            values.push(this.popValue());
        }
        this.pushValue(values);
    };

    JavaScriptCompiler.prototype.prepareObject = function prepareObject(size) {
        false && assert(this.values.length >= size, 'Expected ' + size + ' values on the stack, found ' + this.values.length);

        var keys = new Array(size);
        var values = new Array(size);
        for (var i = 0; i < size; i++) {
            keys[i] = this.popValue();
            values[i] = this.popValue();
        }
        this.pushValue([keys, values]);
    };
    /// Utilities


    JavaScriptCompiler.prototype.endComponent = function endComponent() {
        var component = this.blocks.pop();
        false && assert(component instanceof ComponentBlock, 'Compiler bug: endComponent() should end a component');

        return component.toJSON();
    };

    JavaScriptCompiler.prototype.startInlineBlock = function startInlineBlock(symbols) {
        var block = new InlineBlock(symbols);
        this.blocks.push(block);
    };

    JavaScriptCompiler.prototype.endInlineBlock = function endInlineBlock() {
        var blocks = this.blocks;

        var block = blocks.pop();
        return block.toJSON();
    };

    JavaScriptCompiler.prototype.push = function push(args) {
        this.currentBlock.push(args);
    };

    JavaScriptCompiler.prototype.pushValue = function pushValue(val) {
        this.values.push(val);
    };

    JavaScriptCompiler.prototype.popValue = function popValue() {
        false && assert(this.values.length, 'No expression found on stack');

        return this.values.pop();
    };

    _createClass(JavaScriptCompiler, [{
        key: 'currentBlock',
        get: function get() {
            return this.blocks.current;
        }
    }, {
        key: 'currentComponent',
        get: function get() {
            var block = this.currentBlock;
            if (block instanceof ComponentBlock) {
                return block;
            } else {
                throw new Error('Expected ComponentBlock on stack, found ' + block.constructor.name);
            }
        }
    }]);

    return JavaScriptCompiler;
}();

export default JavaScriptCompiler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3BhY2thZ2VzL0BnbGltbWVyL2NvbXBpbGVyL2xpYi9qYXZhc2NyaXB0LWNvbXBpbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxTQUFBLE1BQUEsUUFBQSxlQUFBO0FBQ0EsU0FBQSxLQUFBLEVBQUEsT0FBQSxRQUFBLGVBQUE7QUFHQSxTQUFBLFVBQUEsRUFBQSxXQUFBLEVBQUEsY0FBQSxRQUFBLHNCQUFBO0FBb0JBLFdBQU0sS0FBTjtBQUFBLHFCQUFBO0FBQUE7O0FBQ1MsYUFBQSxVQUFBLEdBQUEsRUFBQTtBQU9SOztBQVJELG9CQUtFLElBTEYsaUJBS0UsU0FMRixFQUtzQztBQUNsQyxhQUFBLFVBQUEsQ0FBQSxJQUFBLENBQUEsU0FBQTtBQUNELEtBUEg7O0FBQUE7QUFBQTtBQVVBLFdBQU0sV0FBTjtBQUFBOztBQUNFLHlCQUFBLEtBQUEsRUFBMEM7QUFBQTs7QUFBQSxxREFDeEMsaUJBRHdDOztBQUF2QixjQUFBLEtBQUEsR0FBQSxLQUFBO0FBQXVCO0FBRXpDOztBQUhILDBCQUtFLE1BTEYscUJBS1E7QUFDSixlQUFPO0FBQ0wsd0JBQVksS0FEUCxVQUFBO0FBRUwsd0JBQVksS0FBQSxLQUFBLENBQVc7QUFGbEIsU0FBUDtBQUlELEtBVkg7O0FBQUE7QUFBQSxFQUFNLEtBQU47QUFhQSxXQUFNLFVBQU47QUFBQTs7QUFDRSx3QkFBQSxJQUFBLEVBQUEsS0FBQSxFQUF3RDtBQUFBOztBQUFBLHNEQUN0RCx3QkFBQSxLQUFBLENBRHNEOztBQUFyQyxlQUFBLElBQUEsR0FBQSxJQUFBO0FBQXFDO0FBRXZEOztBQUhIO0FBQUEsRUFBTSxXQUFOO0FBTUEsV0FBTSxhQUFOO0FBQUE7O0FBT0UsMkJBQUEsV0FBQSxFQUE0QztBQUFBOztBQUFBLHNEQUMxQyxrQkFEMEM7O0FBQXhCLGVBQUEsV0FBQSxHQUFBLFdBQUE7QUFOYixlQUFBLElBQUEsR0FBQSxVQUFBO0FBQ0EsZUFBQSxNQUFBLEdBQVMsSUFBVCxPQUFTLEVBQVQ7QUFDQSxlQUFBLEtBQUEsR0FBUSxJQUFSLE9BQVEsRUFBUjtBQUNBLGVBQUEsTUFBQSxHQUFBLEVBQUE7QUFDQSxlQUFBLE9BQUEsR0FBQSxLQUFBO0FBRXFDO0FBRTNDOztBQVRILDRCQVdFLElBWEYsaUJBV0UsU0FYRixFQVcyQjtBQUN2QixhQUFBLFVBQUEsQ0FBQSxJQUFBLENBQUEsU0FBQTtBQUNELEtBYkg7O0FBQUEsNEJBZUUsTUFmRixxQkFlUTtBQUNKLGVBQU87QUFDTCxxQkFBUyxLQUFBLFdBQUEsQ0FESixPQUFBO0FBRUwsd0JBQVksS0FGUCxVQUFBO0FBR0wscUJBQVMsS0FBSztBQUhULFNBQVA7QUFLRCxLQXJCSDs7QUFBQTtBQUFBLEVBQU0sS0FBTjtBQXdCQSxXQUFNLGNBQU47QUFBQTs7QUFPRSw0QkFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBLFdBQUEsRUFBOEY7QUFBQTs7QUFBQSxzREFDNUYsa0JBRDRGOztBQUExRSxlQUFBLEdBQUEsR0FBQSxHQUFBO0FBQXFCLGVBQUEsS0FBQSxHQUFBLEtBQUE7QUFBaUMsZUFBQSxXQUFBLEdBQUEsV0FBQTtBQU5uRSxlQUFBLFVBQUEsR0FBQSxFQUFBO0FBQ0EsZUFBQSxTQUFBLEdBQUEsRUFBQTtBQUNDLGVBQUEsUUFBQSxHQUFBLElBQUE7QUFDRCxlQUFBLFdBQUEsR0FBQSxFQUFBO0FBQ0EsZUFBQSxNQUFBLEdBQUEsRUFBQTtBQUV1RjtBQUU3Rjs7QUFUSCw2QkFXRSxJQVhGLGlCQVdFLFNBWEYsRUFXMkI7QUFDdkIsWUFBSSxLQUFKLFFBQUEsRUFBbUI7QUFDakIsZ0JBQUksZUFBSixTQUFJLENBQUosRUFBK0I7QUFDN0IscUJBQUEsUUFBQSxHQUFBLEtBQUE7QUFERixhQUFBLE1BRU8sSUFBSSxXQUFKLFNBQUksQ0FBSixFQUEyQjtBQUNoQyxxQkFBQSxTQUFBLENBQUEsSUFBQSxDQUFBLFNBQUE7QUFESyxhQUFBLE1BRUEsSUFBSSxZQUFKLFNBQUksQ0FBSixFQUE0QjtBQUNqQyxxQkFBQSxVQUFBLENBQUEsSUFBQSxDQUFBLFNBQUE7QUFESyxhQUFBLE1BRUE7QUFDTCxzQkFBTSxJQUFBLEtBQUEsQ0FBTiw2REFBTSxDQUFOO0FBQ0Q7QUFUSCxTQUFBLE1BVU87QUFDTCxpQkFBQSxVQUFBLENBQUEsSUFBQSxDQUFBLFNBQUE7QUFDRDtBQUNGLEtBekJIOztBQUFBLDZCQTJCRSxTQTNCRixzQkEyQkUsSUEzQkYsRUEyQkUsS0EzQkYsRUEyQnNEO0FBQ2xELGFBQUEsTUFBQSxDQUFBLElBQUEsQ0FBaUIsQ0FBQSxJQUFBLEVBQWpCLEtBQWlCLENBQWpCO0FBQ0QsS0E3Qkg7O0FBQUEsNkJBK0JFLE1BL0JGLHFCQStCUTtBQUNKLFlBQUEsZUFBQTtBQUNBLFlBQUksT0FBTyxLQUFYLFNBQUE7QUFDQSxZQUFJLE9BQU8sS0FBQSxHQUFBLENBQVM7QUFBQSxtQkFBTyxJQUEzQixDQUEyQixDQUFQO0FBQUEsU0FBVCxDQUFYO0FBQ0EsWUFBSSxTQUFTLEtBQUEsR0FBQSxDQUFTO0FBQUEsbUJBQU8sSUFBN0IsQ0FBNkIsQ0FBUDtBQUFBLFNBQVQsQ0FBYjtBQUVBLFlBQUksS0FBSixXQUFBLEVBQXNCO0FBQ3BCLHFCQUFBLElBQUE7QUFERixTQUFBLE1BRU8sSUFBSSxLQUFBLE1BQUEsQ0FBQSxNQUFBLEdBQUosQ0FBQSxFQUE0QjtBQUNqQyxnQkFBSSxRQUFKLEVBQUE7QUFDQSxnQkFBSSxVQUFKLEVBQUE7QUFFQSxpQkFBSyxJQUFJLElBQVQsQ0FBQSxFQUFnQixJQUFJLEtBQUEsTUFBQSxDQUFwQixNQUFBLEVBQUEsR0FBQSxFQUE2QztBQUFBLGdDQUN4QixLQUFBLE1BQUEsQ0FBbkIsQ0FBbUIsQ0FEd0I7QUFBQSxvQkFDdkMsR0FEdUM7QUFBQSxvQkFDdkMsS0FEdUM7O0FBRTNDLHNCQUFBLElBQUEsQ0FBVSxJQUFBLEtBQUEsQ0FBVixDQUFVLENBQVY7QUFDQSx3QkFBQSxJQUFBLENBQUEsS0FBQTtBQUNEO0FBQ0QscUJBQVMsQ0FBQSxLQUFBLEVBQVQsT0FBUyxDQUFUO0FBVEssU0FBQSxNQVVBO0FBQ0wscUJBQVMsQ0FDUCxDQURPLFNBQ1AsQ0FETyxFQUVQLENBQ0U7QUFDRSw0QkFBWSxLQURkLFVBQUE7QUFFRSw0QkFBWSxLQUFBLEtBQUEsQ0FBVztBQUZ6QixhQURGLENBRk8sQ0FBVDtBQVNEO0FBRUQsZUFBTyxDQUFDLEtBQUQsR0FBQSxFQUFXLEtBQVgsVUFBQSxFQUE0QixDQUFBLElBQUEsRUFBNUIsTUFBNEIsQ0FBNUIsRUFBUCxNQUFPLENBQVA7QUFDRCxLQTlESDs7QUFBQTtBQUFBLEVBQU0sS0FBTjtBQWlFQSxXQUFNLFFBQU47QUFHRSxzQkFBQSxPQUFBLEVBQWdDO0FBQUE7O0FBQzlCLGFBQUEsS0FBQSxHQUFhLElBQUEsYUFBQSxDQUFiLE9BQWEsQ0FBYjtBQUNEOztBQUxILHVCQU9FLE1BUEYscUJBT1E7QUFDSixlQUFPLEtBQUEsS0FBQSxDQUFQLE1BQU8sRUFBUDtBQUNELEtBVEg7O0FBQUE7QUFBQTs7SUFtQmMsa0I7QUFhWixnQ0FBQSxPQUFBLEVBQUEsT0FBQSxFQUFBLE9BQUEsRUFBMkU7QUFBQTs7QUFMbkUsYUFBQSxNQUFBLEdBQVMsSUFBVCxLQUFTLEVBQVQ7QUFFQSxhQUFBLE1BQUEsR0FBQSxFQUFBO0FBSU4sYUFBQSxPQUFBLEdBQUEsT0FBQTtBQUNBLGFBQUEsUUFBQSxHQUFnQixJQUFBLFFBQUEsQ0FBaEIsT0FBZ0IsQ0FBaEI7QUFDQSxhQUFBLE9BQUEsR0FBQSxPQUFBO0FBQ0Q7O3VCQWZELE8sb0JBQUEsTyxFQUFBLE8sRUFBQSxPLEVBQThFO0FBQzVFLFlBQUksV0FBVyxJQUFBLGtCQUFBLENBQUEsT0FBQSxFQUFBLE9BQUEsRUFBZixPQUFlLENBQWY7QUFDQSxlQUFPLFNBQVAsT0FBTyxFQUFQO0FBQ0QsSzs7aUNBNEJELE8sc0JBQU87QUFBQTs7QUFDTCxhQUFBLE9BQUEsQ0FBQSxPQUFBLENBQXFCLGNBQUs7QUFDeEIsZ0JBQUksU0FBUyxHQUFiLENBQWEsQ0FBYjtBQUNBLGdCQUFJLE1BQU0sR0FBVixDQUFVLENBQVY7QUFFQSxnQkFBSSxDQUFDLE9BQUwsTUFBSyxDQUFMLEVBQW1CO0FBQ2pCLHNCQUFNLElBQUEsS0FBQSxvQkFBTixNQUFNLDRCQUFOO0FBQ0Q7QUFDQSxtQkFBQSxNQUFBLEVBQUEsR0FBQTtBQVBILFNBQUE7QUFTQSxlQUFPLEtBQVAsUUFBQTtBQUNELEs7QUFFRDs7O2lDQUVBLFUsdUJBQUEsTyxFQUE2QjtBQUMzQixhQUFBLGdCQUFBLENBQXNCLFFBQXRCLE9BQUE7QUFDRCxLOztpQ0FFRCxRLHVCQUFRO0FBQ04sWUFBSSxRQUFRLEtBQVosY0FBWSxFQUFaO0FBQ0EsYUFBQSxRQUFBLENBQUEsS0FBQSxDQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsS0FBQTtBQUNELEs7O2lDQUVELFksMkJBQVk7QUFDVixhQUFBLE1BQUEsQ0FBQSxJQUFBLENBQWlCLEtBQUEsUUFBQSxDQUFqQixLQUFBO0FBQ0QsSzs7aUNBRUQsVSx5QkFBVSxDQUFLLEM7QUFFZjs7O2lDQUVBLEksaUJBQUEsTyxFQUFvQjtBQUNsQixhQUFBLElBQUEsQ0FBVSxDQUFBLENBQUEsQ0FBQSxVQUFBLEVBQVYsT0FBVSxDQUFWO0FBQ0QsSzs7aUNBRUQsTSxtQkFBQSxPLEVBQXVCO0FBQ3JCLGFBQUEsSUFBQSxDQUFVLENBQUEsQ0FBQSxDQUFBLFlBQUEsRUFBcUIsS0FBckIsUUFBcUIsRUFBckIsRUFBVixPQUFVLENBQVY7QUFDRCxLOztpQ0FFRCxPLG9CQUFBLEssRUFBcUI7QUFDbkIsYUFBQSxJQUFBLENBQVUsQ0FBQSxDQUFBLENBQUEsYUFBQSxFQUFWLEtBQVUsQ0FBVjtBQUNELEs7O2lDQUVELFEscUJBQUEsSSxFQUFxQjtBQUNuQixZQUFJLFNBQVMsS0FBYixRQUFhLEVBQWI7QUFDQSxZQUFJLE9BQU8sS0FBWCxRQUFXLEVBQVg7QUFDQSxhQUFBLElBQUEsQ0FBVSxDQUFBLENBQUEsQ0FBQSxjQUFBLEVBQUEsSUFBQSxFQUFBLE1BQUEsRUFBVixJQUFVLENBQVY7QUFDRCxLOztpQ0FFRCxLLHdCQUFpRTtBQUFBLFlBQTNELElBQTJEO0FBQUEsWUFBM0QsUUFBMkQ7QUFBQSxZQUFqRSxPQUFpRTs7QUFDL0QsWUFBSSxTQUFTLEtBQWIsUUFBYSxFQUFiO0FBQ0EsWUFBSSxPQUFPLEtBQVgsUUFBVyxFQUFYO0FBRUEsWUFBSSxTQUFTLEtBQUEsUUFBQSxDQUFBLEtBQUEsQ0FBYixNQUFBO0FBSitELGlCQUsvRCxPQUNFLE9BQUEsUUFBQSxLQUFBLFFBQUEsSUFBZ0MsT0FBQSxRQUFBLE1BRGxDLElBQUEsRUFMK0QsK0JBSy9ELENBTCtEO0FBQUEsaUJBUy9ELE9BQ0UsT0FBQSxPQUFBLEtBQUEsUUFBQSxJQUErQixPQUFBLE9BQUEsTUFEakMsSUFBQSxFQVQrRCwrQkFTL0QsQ0FUK0Q7O0FBYy9ELFlBQUEsb0JBQUE7QUFFQSxZQUFJLGFBQUEsSUFBQSxJQUFxQixZQUF6QixJQUFBLEVBQTJDO0FBQ3pDLDBCQUFBLElBQUE7QUFERixTQUFBLE1BRU8sSUFBSSxZQUFKLElBQUEsRUFBc0I7QUFDM0IsMEJBQWMsQ0FBQyxDQUFELFNBQUMsQ0FBRCxFQUFjLENBQUMsT0FBN0IsUUFBNkIsQ0FBRCxDQUFkLENBQWQ7QUFESyxTQUFBLE1BRUE7QUFDTCwwQkFBYyxDQUFDLENBQUEsU0FBQSxFQUFELE1BQUMsQ0FBRCxFQUFzQixDQUFDLE9BQUQsUUFBQyxDQUFELEVBQW1CLE9BQXZELE9BQXVELENBQW5CLENBQXRCLENBQWQ7QUFDRDtBQUVELGFBQUEsSUFBQSxDQUFVLENBQUEsQ0FBQSxDQUFBLFdBQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBLElBQUEsRUFBVixXQUFVLENBQVY7QUFDRCxLOztpQ0FFRCxhLDBCQUFBLE8sRUFBc0M7QUFDcEMsWUFBSSxNQUNGLEtBQUEsT0FBQSxJQUFnQixLQUFBLE9BQUEsQ0FBaEIsc0JBQUEsR0FDSSxLQUFBLE9BQUEsQ0FBQSxzQkFBQSxDQUFvQyxRQUR4QyxHQUNJLENBREosR0FFSSxRQUhOLEdBQUE7QUFJQSxZQUFJLFlBQVksSUFBQSxjQUFBLENBQUEsR0FBQSxFQUF3QixRQUF4QixPQUFBLEVBQTBDLFFBQTFELFdBQWdCLENBQWhCO0FBQ0EsYUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLFNBQUE7QUFDRCxLOztpQ0FFRCxjLDJCQUFBLE8sRUFBdUM7QUFDckMsWUFBSSxRQUFlLElBQUEsVUFBQSxDQUFlLFFBQWYsR0FBQSxFQUE0QixRQUEvQyxPQUFtQixDQUFuQjtBQUNBLGFBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxLQUFBO0FBQ0QsSzs7aUNBRUQsVywrQkFBeUQ7QUFBQSxZQUE3QyxPQUE2QztBQUFBLFlBQXpELE1BQXlEOztBQUN2RCxZQUFJLE1BQU0sUUFBVixHQUFBO0FBRUEsWUFBSSxRQUFBLFdBQUEsQ0FBQSxNQUFBLEdBQUosQ0FBQSxFQUFvQztBQUNsQyxrQkFBTSxJQUFBLEtBQUEsc0JBQ2UsUUFEckIsR0FBTSxnRUFBTjtBQURGLFNBQUEsTUFJTztBQUNMLGlCQUFBLElBQUEsQ0FBVSxDQUFBLENBQUEsQ0FBQSxpQkFBQSxFQUFBLEdBQUEsRUFBVixNQUFVLENBQVY7QUFDRDtBQUNGLEs7O2lDQUVELFksMkJBQVk7QUFDVixhQUFBLElBQUEsQ0FBVSxDQUFBLENBQUEsQ0FBVixrQkFBVSxDQUFWO0FBQ0QsSzs7aUNBRUQsYywyQkFBQSxRLEVBQXdDO0FBQUEsNEJBQ0wsS0FBakMsWUFBaUMsRUFESztBQUFBLFlBQ2xDLEdBRGtDO0FBQUEsWUFDbEMsS0FEa0M7QUFBQSxZQUNsQyxJQURrQztBQUFBLFlBQ2xDLE1BRGtDOztBQUd0QyxhQUFBLElBQUEsQ0FBVSxDQUFBLENBQUEsQ0FBQSxlQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxJQUFBLEVBQVYsTUFBVSxDQUFWO0FBQ0QsSzs7aUNBRUQsZSw0QkFBQSxRLEVBQXlDO0FBQUEsWUFDbkMsTUFEbUMsR0FDdkMsSUFEdUMsQ0FDbkMsTUFEbUM7O0FBRXZDLFlBQUksUUFBZSxPQUFuQixHQUFtQixFQUFuQjtBQUVBLGFBQUEsZ0JBQUEsQ0FBQSxTQUFBLENBQWdDLE1BQWhDLElBQUEsRUFBNEMsTUFBNUMsTUFBNEMsRUFBNUM7QUFDRCxLOztpQ0FFRCxxQixrQ0FBQSxRLEVBQStDO0FBQUEsNkJBQ2hCLEtBQTdCLFlBQTZCLEVBRGdCO0FBQUEsWUFDekMsS0FEeUM7QUFBQSxZQUN6QyxJQUR5QztBQUFBLFlBQ3pDLEtBRHlDOztBQUc3QyxhQUFBLElBQUEsQ0FBVSxDQUFBLENBQUEsQ0FBQSxzQkFBQSxFQUErQixLQUEvQixRQUErQixFQUEvQixFQUFBLEtBQUEsRUFBQSxJQUFBLEVBQVYsS0FBVSxDQUFWO0FBQ0QsSzs7aUNBRUQsWSx5QkFBQSxRLEVBQXNDO0FBQ3BDLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFWLGtCQUFVLENBQVY7QUFDRCxLOztpQ0FFRCxVLDhCQUFzRDtBQUFBLFlBQTNDLElBQTJDO0FBQUEsWUFBdEQsU0FBc0Q7O0FBQ3BELFlBQUksUUFBUSxLQUFaLFFBQVksRUFBWjtBQUNBLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLGdCQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBVixTQUFVLENBQVY7QUFDRCxLOztpQ0FFRCxXLCtCQUF1RDtBQUFBLFlBQTNDLElBQTJDO0FBQUEsWUFBdkQsU0FBdUQ7O0FBQ3JELFlBQUksUUFBUSxLQUFaLFFBQVksRUFBWjtBQUNBLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLGlCQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBVixTQUFVLENBQVY7QUFDRCxLOztpQ0FFRCxhLGlDQUF5RDtBQUFBLFlBQTNDLElBQTJDO0FBQUEsWUFBekQsU0FBeUQ7O0FBQ3ZELFlBQUksUUFBUSxLQUFaLFFBQVksRUFBWjtBQUNBLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLG1CQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBVixTQUFVLENBQVY7QUFDRCxLOztpQ0FFRCxZLGdDQUF3RDtBQUFBLFlBQTNDLElBQTJDO0FBQUEsWUFBeEQsU0FBd0Q7O0FBQ3RELFlBQUksUUFBUSxLQUFaLFFBQVksRUFBWjtBQUNBLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLHlCQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBVixTQUFVLENBQVY7QUFDRCxLOztpQ0FFRCxxQix5Q0FBaUU7QUFBQSxZQUEzQyxJQUEyQztBQUFBLFlBQWpFLFNBQWlFOztBQUMvRCxZQUFJLFFBQVEsS0FBWixRQUFZLEVBQVo7QUFDQSxhQUFBLElBQUEsQ0FBVSxDQUFBLEVBQUEsQ0FBQSwyQkFBQSxFQUFBLElBQUEsRUFBQSxLQUFBLEVBQVYsU0FBVSxDQUFWO0FBQ0QsSzs7aUNBRUQsUyxzQkFBQSxJLEVBQW1CO0FBQ2pCLFlBQUksUUFBUSxLQUFaLFFBQVksRUFBWjtBQUNBLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLGVBQUEsRUFBQSxJQUFBLEVBQVYsS0FBVSxDQUFWO0FBQ0QsSzs7aUNBRUQsVSx1QkFBQSxJLEVBQW9CO0FBQ2xCLFlBQUksUUFBUSxLQUFaLFFBQVksRUFBWjtBQUNBLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLGdCQUFBLEVBQUEsSUFBQSxFQUFWLEtBQVUsQ0FBVjtBQUNELEs7O2lDQUVELEssbUJBQUEsRSxFQUFnQjtBQUNkLFlBQUksU0FBUyxLQUFiLFFBQWEsRUFBYjtBQUNBLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLFdBQUEsRUFBQSxFQUFBLEVBQVYsTUFBVSxDQUFWO0FBQ0QsSzs7aUNBRUQsUyxzQkFBQSxFLEVBQTRCO0FBQzFCO0FBQ0E7QUFDQSxhQUFBLFFBQUE7QUFDQSxhQUFBLElBQUEsQ0FBVSxDQUFBLEVBQUEsQ0FBQSxlQUFBLEVBQVYsRUFBVSxDQUFWO0FBQ0QsSzs7aUNBRUQsUSxzQkFBQSxRLEVBQXdDO0FBQ3RDLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLGNBQUEsRUFBVixRQUFVLENBQVY7QUFDQSxhQUFBLFFBQUEsQ0FBQSxLQUFBLENBQUEsT0FBQSxHQUFBLElBQUE7QUFDRCxLOztpQ0FFRCxRLHFCQUFBLEksRUFBcUI7QUFDbkIsYUFBQSxTQUFBLENBQXFDLENBQUEsRUFBQSxDQUFBLGNBQUEsRUFBckMsSUFBcUMsQ0FBckM7QUFDRCxLOztpQ0FFRCxjLDJCQUFBLEksRUFBMkI7QUFDekIsYUFBQSxTQUFBLENBQTJDLENBQUEsRUFBQSxDQUFBLG9CQUFBLEVBQTNDLElBQTJDLENBQTNDO0FBQ0QsSzs7aUNBRUQsTyxvQkFBQSxRLEVBQXVDO0FBQ3JDLFlBQUksU0FBUyxLQUFiLFFBQWEsRUFBYjtBQUNBLGFBQUEsSUFBQSxDQUFVLENBQUEsRUFBQSxDQUFBLGFBQUEsRUFBc0IsT0FBdEIsQ0FBc0IsQ0FBdEIsRUFBVixRQUFVLENBQVY7QUFDQSxhQUFBLFFBQUEsQ0FBQSxLQUFBLENBQUEsT0FBQSxHQUFBLElBQUE7QUFDRCxLO0FBRUQ7OztpQ0FFQSxPLG9CQUFBLEssRUFBNEM7QUFDMUMsWUFBSSxVQUFKLFNBQUEsRUFBeUI7QUFDdkIsaUJBQUEsU0FBQSxDQUFzQyxDQUFBLEVBQUEsQ0FBdEMsZUFBc0MsQ0FBdEM7QUFERixTQUFBLE1BRU87QUFDTCxpQkFBQSxTQUFBLENBQUEsS0FBQTtBQUNEO0FBQ0YsSzs7aUNBRUQsTyxvQkFBQSxJLEVBQW9CO0FBQ2xCLGFBQUEsU0FBQSxDQUFvQyxDQUFBLEVBQUEsQ0FBQSxhQUFBLEVBQXBDLElBQW9DLENBQXBDO0FBQ0QsSzs7aUNBRUQsRyx1QkFBb0M7QUFBQSxZQUFoQyxJQUFnQztBQUFBLFlBQXBDLElBQW9DOztBQUNsQyxhQUFBLFNBQUEsQ0FBZ0MsQ0FBQSxFQUFBLENBQUEsU0FBQSxFQUFBLElBQUEsRUFBaEMsSUFBZ0MsQ0FBaEM7QUFDRCxLOztpQ0FFRCxVLHVCQUFBLEksRUFBeUI7QUFDdkIsYUFBQSxTQUFBLENBQXVDLENBQUEsRUFBQSxDQUFBLGdCQUFBLEVBQXZDLElBQXVDLENBQXZDO0FBQ0QsSzs7aUNBRUQsTSxxQkFBTTtBQUNKLGFBQUEsU0FBQSxDQUFtQyxDQUFBLEVBQUEsQ0FBQSxZQUFBLEVBQXFCLEtBQXhELFFBQXdELEVBQXJCLENBQW5DO0FBQ0QsSzs7aUNBRUQsTSxtQkFBQSxJLEVBQW1CO0FBQ2pCLFlBQUksU0FBUyxLQUFiLFFBQWEsRUFBYjtBQUNBLFlBQUksT0FBTyxLQUFYLFFBQVcsRUFBWDtBQUVBLGFBQUEsU0FBQSxDQUFtQyxDQUFBLEVBQUEsQ0FBQSxZQUFBLEVBQUEsSUFBQSxFQUFBLE1BQUEsRUFBbkMsSUFBbUMsQ0FBbkM7QUFDRCxLO0FBRUQ7OztpQ0FFQSxZLHlCQUFBLEksRUFBeUI7QUFDdkIsWUFBSSxTQUFKLEVBQUE7QUFFQSxhQUFLLElBQUksSUFBVCxDQUFBLEVBQWdCLElBQWhCLElBQUEsRUFBQSxHQUFBLEVBQStCO0FBQzdCLG1CQUFBLElBQUEsQ0FBWSxLQUFaLFFBQVksRUFBWjtBQUNEO0FBRUQsYUFBQSxTQUFBLENBQUEsTUFBQTtBQUNELEs7O2lDQUVELGEsMEJBQUEsSSxFQUEwQjtBQUFBLGlCQUN4QixPQUNFLEtBQUEsTUFBQSxDQUFBLE1BQUEsSUFERixJQUFBLGdCQUVjLElBRmQsb0NBRWlELEtBQUEsTUFBQSxDQUh6QixNQUN4QixDQUR3Qjs7QUFNeEIsWUFBSSxPQUFpQixJQUFBLEtBQUEsQ0FBckIsSUFBcUIsQ0FBckI7QUFDQSxZQUFJLFNBQXVCLElBQUEsS0FBQSxDQUEzQixJQUEyQixDQUEzQjtBQUVBLGFBQUssSUFBSSxJQUFULENBQUEsRUFBZ0IsSUFBaEIsSUFBQSxFQUFBLEdBQUEsRUFBK0I7QUFDN0IsaUJBQUEsQ0FBQSxJQUFVLEtBQVYsUUFBVSxFQUFWO0FBQ0EsbUJBQUEsQ0FBQSxJQUFZLEtBQVosUUFBWSxFQUFaO0FBQ0Q7QUFFRCxhQUFBLFNBQUEsQ0FBcUIsQ0FBQSxJQUFBLEVBQXJCLE1BQXFCLENBQXJCO0FBQ0QsSztBQUVEOzs7aUNBRUEsWSwyQkFBWTtBQUNWLFlBQUksWUFBWSxLQUFBLE1BQUEsQ0FBaEIsR0FBZ0IsRUFBaEI7QUFEVSxpQkFFVixPQUNFLHFCQURGLGNBQUEsRUFGVSxxREFFVixDQUZVOztBQU9WLGVBQVEsVUFBUixNQUFRLEVBQVI7QUFDRCxLOztpQ0FFRCxnQiw2QkFBQSxPLEVBQTBDO0FBQ3hDLFlBQUksUUFBZSxJQUFBLFdBQUEsQ0FBbkIsT0FBbUIsQ0FBbkI7QUFDQSxhQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsS0FBQTtBQUNELEs7O2lDQUVELGMsNkJBQWM7QUFBQSxZQUNSLE1BRFEsR0FDWixJQURZLENBQ1IsTUFEUTs7QUFFWixZQUFJLFFBQVEsT0FBWixHQUFZLEVBQVo7QUFDQSxlQUFPLE1BQVAsTUFBTyxFQUFQO0FBQ0QsSzs7aUNBRUQsSSxpQkFBQSxJLEVBQW9CO0FBQ2xCLGFBQUEsWUFBQSxDQUFBLElBQUEsQ0FBQSxJQUFBO0FBQ0QsSzs7aUNBRUQsUyxzQkFBQSxHLEVBQXNEO0FBQ3BELGFBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxHQUFBO0FBQ0QsSzs7aUNBRUQsUSx1QkFBUTtBQUFBLGlCQUNOLE9BQU8sS0FBQSxNQUFBLENBQVAsTUFBQSxFQURNLDhCQUNOLENBRE07O0FBRU4sZUFBTyxLQUFBLE1BQUEsQ0FBUCxHQUFPLEVBQVA7QUFDRCxLOzs7OzRCQWxUZTtBQUNkLG1CQUFjLEtBQUEsTUFBQSxDQUFkLE9BQUE7QUFDRDs7OzRCQUVtQjtBQUNsQixnQkFBSSxRQUFRLEtBQVosWUFBQTtBQUVBLGdCQUFJLGlCQUFKLGNBQUEsRUFBcUM7QUFDbkMsdUJBQUEsS0FBQTtBQURGLGFBQUEsTUFFTztBQUNMLHNCQUFNLElBQUEsS0FBQSw4Q0FBcUQsTUFBQSxXQUFBLENBQTNELElBQU0sQ0FBTjtBQUNEO0FBQ0Y7Ozs7OztlQS9CVyxrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzc2VydCB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgU3RhY2ssIERpY3RTZXQsIE9wdGlvbiwgZXhwZWN0IH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQgeyBBU1QgfSBmcm9tICdAZ2xpbW1lci9zeW50YXgnO1xuaW1wb3J0IHsgQ29tcGlsZU9wdGlvbnMgfSBmcm9tICcuL3RlbXBsYXRlLWNvbXBpbGVyJztcbmltcG9ydCB7IGlzQXJndW1lbnQsIGlzQXR0cmlidXRlLCBpc0ZsdXNoRWxlbWVudCB9IGZyb20gJ0BnbGltbWVyL3dpcmUtZm9ybWF0JztcbmltcG9ydCB7IFByb2Nlc3NvciwgQ29tcGlsZXJPcHMsIE9wTmFtZSwgT3AgfSBmcm9tICcuL2NvbXBpbGVyLW9wcyc7XG5pbXBvcnQge1xuICBXaXJlRm9ybWF0LFxuICBTZXJpYWxpemVkSW5saW5lQmxvY2ssXG4gIFN0YXRlbWVudCxcbiAgU2VyaWFsaXplZFRlbXBsYXRlQmxvY2ssXG4gIFN0YXRlbWVudHMsXG4gIFNleHBPcGNvZGVzLFxuICBFeHByZXNzaW9uLFxuICBFeHByZXNzaW9ucyxcbn0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5cbmV4cG9ydCB0eXBlIHN0ciA9IHN0cmluZztcbmltcG9ydCBDb3JlID0gV2lyZUZvcm1hdC5Db3JlO1xuZXhwb3J0IHR5cGUgUGFyYW1zID0gV2lyZUZvcm1hdC5Db3JlLlBhcmFtcztcbmV4cG9ydCB0eXBlIEhhc2ggPSBXaXJlRm9ybWF0LkNvcmUuSGFzaDtcbmV4cG9ydCB0eXBlIFBhdGggPSBXaXJlRm9ybWF0LkNvcmUuUGF0aDtcbmV4cG9ydCB0eXBlIFN0YWNrVmFsdWUgPSBXaXJlRm9ybWF0LkV4cHJlc3Npb24gfCBQYXJhbXMgfCBIYXNoIHwgc3RyO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmxvY2sge1xuICBwdWJsaWMgc3RhdGVtZW50czogV2lyZUZvcm1hdC5TdGF0ZW1lbnRbXSA9IFtdO1xuXG4gIGFic3RyYWN0IHRvSlNPTigpOiBPYmplY3Q7XG5cbiAgcHVzaChzdGF0ZW1lbnQ6IFdpcmVGb3JtYXQuU3RhdGVtZW50KSB7XG4gICAgdGhpcy5zdGF0ZW1lbnRzLnB1c2goc3RhdGVtZW50KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSW5saW5lQmxvY2sgZXh0ZW5kcyBCbG9jayB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB0YWJsZTogQVNULkJsb2NrU3ltYm9scykge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICB0b0pTT04oKTogU2VyaWFsaXplZElubGluZUJsb2NrIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdGVtZW50czogdGhpcy5zdGF0ZW1lbnRzLFxuICAgICAgcGFyYW1ldGVyczogdGhpcy50YWJsZS5zbG90cyxcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOYW1lZEJsb2NrIGV4dGVuZHMgSW5saW5lQmxvY2sge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nLCB0YWJsZTogQVNULkJsb2NrU3ltYm9scykge1xuICAgIHN1cGVyKHRhYmxlKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgVGVtcGxhdGVCbG9jayBleHRlbmRzIEJsb2NrIHtcbiAgcHVibGljIHR5cGUgPSAndGVtcGxhdGUnO1xuICBwdWJsaWMgeWllbGRzID0gbmV3IERpY3RTZXQ8c3RyaW5nPigpO1xuICBwdWJsaWMgbmFtZWQgPSBuZXcgRGljdFNldDxzdHJpbmc+KCk7XG4gIHB1YmxpYyBibG9ja3M6IFNlcmlhbGl6ZWRJbmxpbmVCbG9ja1tdID0gW107XG4gIHB1YmxpYyBoYXNFdmFsID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzeW1ib2xUYWJsZTogQVNULlN5bWJvbHMpIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVzaChzdGF0ZW1lbnQ6IFN0YXRlbWVudCkge1xuICAgIHRoaXMuc3RhdGVtZW50cy5wdXNoKHN0YXRlbWVudCk7XG4gIH1cblxuICB0b0pTT04oKTogU2VyaWFsaXplZFRlbXBsYXRlQmxvY2sge1xuICAgIHJldHVybiB7XG4gICAgICBzeW1ib2xzOiB0aGlzLnN5bWJvbFRhYmxlLnN5bWJvbHMsXG4gICAgICBzdGF0ZW1lbnRzOiB0aGlzLnN0YXRlbWVudHMsXG4gICAgICBoYXNFdmFsOiB0aGlzLmhhc0V2YWwsXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29tcG9uZW50QmxvY2sgZXh0ZW5kcyBCbG9jayB7XG4gIHB1YmxpYyBhdHRyaWJ1dGVzOiBTdGF0ZW1lbnRzLkF0dHJpYnV0ZVtdID0gW107XG4gIHB1YmxpYyBhcmd1bWVudHM6IFN0YXRlbWVudHMuQXJndW1lbnRbXSA9IFtdO1xuICBwcml2YXRlIGluUGFyYW1zID0gdHJ1ZTtcbiAgcHVibGljIHBvc2l0aW9uYWxzOiBudW1iZXJbXSA9IFtdO1xuICBwdWJsaWMgYmxvY2tzOiBBcnJheTxbc3RyaW5nLCBTZXJpYWxpemVkSW5saW5lQmxvY2tdPiA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdGFnOiBzdHJpbmcsIHByaXZhdGUgdGFibGU6IEFTVC5CbG9ja1N5bWJvbHMsIHByaXZhdGUgc2VsZkNsb3Npbmc6IGJvb2xlYW4pIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgcHVzaChzdGF0ZW1lbnQ6IFN0YXRlbWVudCkge1xuICAgIGlmICh0aGlzLmluUGFyYW1zKSB7XG4gICAgICBpZiAoaXNGbHVzaEVsZW1lbnQoc3RhdGVtZW50KSkge1xuICAgICAgICB0aGlzLmluUGFyYW1zID0gZmFsc2U7XG4gICAgICB9IGVsc2UgaWYgKGlzQXJndW1lbnQoc3RhdGVtZW50KSkge1xuICAgICAgICB0aGlzLmFyZ3VtZW50cy5wdXNoKHN0YXRlbWVudCk7XG4gICAgICB9IGVsc2UgaWYgKGlzQXR0cmlidXRlKHN0YXRlbWVudCkpIHtcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLnB1c2goc3RhdGVtZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tcGlsZSBFcnJvcjogb25seSBwYXJhbWV0ZXJzIGFsbG93ZWQgYmVmb3JlIGZsdXNoLWVsZW1lbnQnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdGF0ZW1lbnRzLnB1c2goc3RhdGVtZW50KTtcbiAgICB9XG4gIH1cblxuICBwdXNoQmxvY2sobmFtZTogc3RyaW5nLCBibG9jazogU2VyaWFsaXplZElubGluZUJsb2NrKSB7XG4gICAgdGhpcy5ibG9ja3MucHVzaChbbmFtZSwgYmxvY2tdKTtcbiAgfVxuXG4gIHRvSlNPTigpOiBbc3RyaW5nLCBTdGF0ZW1lbnRzLkF0dHJpYnV0ZVtdLCBDb3JlLkhhc2gsIENvcmUuQmxvY2tzXSB7XG4gICAgbGV0IGJsb2NrczogQ29yZS5CbG9ja3M7XG4gICAgbGV0IGFyZ3MgPSB0aGlzLmFyZ3VtZW50cztcbiAgICBsZXQga2V5cyA9IGFyZ3MubWFwKGFyZyA9PiBhcmdbMV0pO1xuICAgIGxldCB2YWx1ZXMgPSBhcmdzLm1hcChhcmcgPT4gYXJnWzJdKTtcblxuICAgIGlmICh0aGlzLnNlbGZDbG9zaW5nKSB7XG4gICAgICBibG9ja3MgPSBudWxsO1xuICAgIH0gZWxzZSBpZiAodGhpcy5ibG9ja3MubGVuZ3RoID4gMCkge1xuICAgICAgbGV0IGtleXM6IHN0cmluZ1tdID0gW107XG4gICAgICBsZXQgdmFsdWVzOiBTZXJpYWxpemVkSW5saW5lQmxvY2tbXSA9IFtdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYmxvY2tzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBba2V5LCB2YWx1ZV0gPSB0aGlzLmJsb2Nrc1tpXTtcbiAgICAgICAga2V5cy5wdXNoKGtleS5zbGljZSgxKSk7XG4gICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGJsb2NrcyA9IFtrZXlzLCB2YWx1ZXNdO1xuICAgIH0gZWxzZSB7XG4gICAgICBibG9ja3MgPSBbXG4gICAgICAgIFsnZGVmYXVsdCddLFxuICAgICAgICBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3RhdGVtZW50czogdGhpcy5zdGF0ZW1lbnRzLFxuICAgICAgICAgICAgcGFyYW1ldGVyczogdGhpcy50YWJsZS5zbG90cyxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgXTtcbiAgICB9XG5cbiAgICByZXR1cm4gW3RoaXMudGFnLCB0aGlzLmF0dHJpYnV0ZXMsIFtrZXlzLCB2YWx1ZXNdLCBibG9ja3NdO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBUZW1wbGF0ZSB7XG4gIHB1YmxpYyBibG9jazogVGVtcGxhdGVCbG9jaztcblxuICBjb25zdHJ1Y3RvcihzeW1ib2xzOiBBU1QuU3ltYm9scykge1xuICAgIHRoaXMuYmxvY2sgPSBuZXcgVGVtcGxhdGVCbG9jayhzeW1ib2xzKTtcbiAgfVxuXG4gIHRvSlNPTigpOiBTZXJpYWxpemVkVGVtcGxhdGVCbG9jayB7XG4gICAgcmV0dXJuIHRoaXMuYmxvY2sudG9KU09OKCk7XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgSW5WYXJpYWJsZSA9IG51bWJlcjtcbmV4cG9ydCB0eXBlIEluT3A8SyBleHRlbmRzIGtleW9mIENvbXBpbGVyT3BzPEluVmFyaWFibGU+ID0gT3BOYW1lPiA9IE9wPFxuICBJblZhcmlhYmxlLFxuICBDb21waWxlck9wczxJblZhcmlhYmxlPixcbiAgS1xuPjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSmF2YVNjcmlwdENvbXBpbGVyXG4gIGltcGxlbWVudHMgUHJvY2Vzc29yPENvbXBpbGVyT3BzPG51bWJlcj4sIHZvaWQsIENvbXBpbGVyT3BzPHZvaWQ+PiB7XG4gIHN0YXRpYyBwcm9jZXNzKG9wY29kZXM6IEluT3BbXSwgc3ltYm9sczogQVNULlN5bWJvbHMsIG9wdGlvbnM/OiBDb21waWxlT3B0aW9ucyk6IFRlbXBsYXRlIHtcbiAgICBsZXQgY29tcGlsZXIgPSBuZXcgSmF2YVNjcmlwdENvbXBpbGVyKG9wY29kZXMsIHN5bWJvbHMsIG9wdGlvbnMpO1xuICAgIHJldHVybiBjb21waWxlci5wcm9jZXNzKCk7XG4gIH1cblxuICBwcml2YXRlIHRlbXBsYXRlOiBUZW1wbGF0ZTtcbiAgcHJpdmF0ZSBibG9ja3MgPSBuZXcgU3RhY2s8QmxvY2s+KCk7XG4gIHByaXZhdGUgb3Bjb2RlczogSW5PcFtdO1xuICBwcml2YXRlIHZhbHVlczogU3RhY2tWYWx1ZVtdID0gW107XG4gIHByaXZhdGUgb3B0aW9uczogQ29tcGlsZU9wdGlvbnMgfCB1bmRlZmluZWQ7XG5cbiAgY29uc3RydWN0b3Iob3Bjb2RlczogSW5PcFtdLCBzeW1ib2xzOiBBU1QuU3ltYm9scywgb3B0aW9ucz86IENvbXBpbGVPcHRpb25zKSB7XG4gICAgdGhpcy5vcGNvZGVzID0gb3Bjb2RlcztcbiAgICB0aGlzLnRlbXBsYXRlID0gbmV3IFRlbXBsYXRlKHN5bWJvbHMpO1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gIH1cblxuICBnZXQgY3VycmVudEJsb2NrKCk6IEJsb2NrIHtcbiAgICByZXR1cm4gZXhwZWN0KHRoaXMuYmxvY2tzLmN1cnJlbnQsICdFeHBlY3RlZCBhIGJsb2NrIG9uIHRoZSBzdGFjaycpO1xuICB9XG5cbiAgZ2V0IGN1cnJlbnRDb21wb25lbnQoKTogQ29tcG9uZW50QmxvY2sge1xuICAgIGxldCBibG9jayA9IHRoaXMuY3VycmVudEJsb2NrO1xuXG4gICAgaWYgKGJsb2NrIGluc3RhbmNlb2YgQ29tcG9uZW50QmxvY2spIHtcbiAgICAgIHJldHVybiBibG9jaztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBDb21wb25lbnRCbG9jayBvbiBzdGFjaywgZm91bmQgJHtibG9jay5jb25zdHJ1Y3Rvci5uYW1lfWApO1xuICAgIH1cbiAgfVxuXG4gIHByb2Nlc3MoKTogVGVtcGxhdGUge1xuICAgIHRoaXMub3Bjb2Rlcy5mb3JFYWNoKG9wID0+IHtcbiAgICAgIGxldCBvcGNvZGUgPSBvcFswXTtcbiAgICAgIGxldCBhcmcgPSBvcFsxXTtcblxuICAgICAgaWYgKCF0aGlzW29wY29kZV0pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmltcGxlbWVudGVkICR7b3Bjb2RlfSBvbiBKYXZhU2NyaXB0Q29tcGlsZXJgKTtcbiAgICAgIH1cbiAgICAgICh0aGlzW29wY29kZV0gYXMgYW55KShhcmcpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLnRlbXBsYXRlO1xuICB9XG5cbiAgLy8vIE5lc3RpbmdcblxuICBzdGFydEJsb2NrKHByb2dyYW06IEFTVC5CbG9jaykge1xuICAgIHRoaXMuc3RhcnRJbmxpbmVCbG9jayhwcm9ncmFtLnN5bWJvbHMhKTtcbiAgfVxuXG4gIGVuZEJsb2NrKCkge1xuICAgIGxldCBibG9jayA9IHRoaXMuZW5kSW5saW5lQmxvY2soKTtcbiAgICB0aGlzLnRlbXBsYXRlLmJsb2NrLmJsb2Nrcy5wdXNoKGJsb2NrKTtcbiAgfVxuXG4gIHN0YXJ0UHJvZ3JhbSgpIHtcbiAgICB0aGlzLmJsb2Nrcy5wdXNoKHRoaXMudGVtcGxhdGUuYmxvY2spO1xuICB9XG5cbiAgZW5kUHJvZ3JhbSgpIHt9XG5cbiAgLy8vIFN0YXRlbWVudHNcblxuICB0ZXh0KGNvbnRlbnQ6IHN0cmluZykge1xuICAgIHRoaXMucHVzaChbU2V4cE9wY29kZXMuVGV4dCwgY29udGVudF0pO1xuICB9XG5cbiAgYXBwZW5kKHRydXN0ZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLkFwcGVuZCwgdGhpcy5wb3BWYWx1ZTxFeHByZXNzaW9uPigpLCB0cnVzdGVkXSk7XG4gIH1cblxuICBjb21tZW50KHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLkNvbW1lbnQsIHZhbHVlXSk7XG4gIH1cblxuICBtb2RpZmllcihuYW1lOiBzdHJpbmcpIHtcbiAgICBsZXQgcGFyYW1zID0gdGhpcy5wb3BWYWx1ZTxQYXJhbXM+KCk7XG4gICAgbGV0IGhhc2ggPSB0aGlzLnBvcFZhbHVlPEhhc2g+KCk7XG4gICAgdGhpcy5wdXNoKFtTZXhwT3Bjb2Rlcy5Nb2RpZmllciwgbmFtZSwgcGFyYW1zLCBoYXNoXSk7XG4gIH1cblxuICBibG9jayhbbmFtZSwgdGVtcGxhdGUsIGludmVyc2VdOiBbc3RyaW5nLCBudW1iZXIsIE9wdGlvbjxudW1iZXI+XSkge1xuICAgIGxldCBwYXJhbXMgPSB0aGlzLnBvcFZhbHVlPFBhcmFtcz4oKTtcbiAgICBsZXQgaGFzaCA9IHRoaXMucG9wVmFsdWU8SGFzaD4oKTtcblxuICAgIGxldCBibG9ja3MgPSB0aGlzLnRlbXBsYXRlLmJsb2NrLmJsb2NrcztcbiAgICBhc3NlcnQoXG4gICAgICB0eXBlb2YgdGVtcGxhdGUgIT09ICdudW1iZXInIHx8IGJsb2Nrc1t0ZW1wbGF0ZV0gIT09IG51bGwsXG4gICAgICAnbWlzc2luZyBibG9jayBpbiB0aGUgY29tcGlsZXInXG4gICAgKTtcbiAgICBhc3NlcnQoXG4gICAgICB0eXBlb2YgaW52ZXJzZSAhPT0gJ251bWJlcicgfHwgYmxvY2tzW2ludmVyc2VdICE9PSBudWxsLFxuICAgICAgJ21pc3NpbmcgYmxvY2sgaW4gdGhlIGNvbXBpbGVyJ1xuICAgICk7XG5cbiAgICBsZXQgbmFtZWRCbG9ja3M6IE9wdGlvbjxDb3JlLkJsb2Nrcz47XG5cbiAgICBpZiAodGVtcGxhdGUgPT09IG51bGwgJiYgaW52ZXJzZSA9PT0gbnVsbCkge1xuICAgICAgbmFtZWRCbG9ja3MgPSBudWxsO1xuICAgIH0gZWxzZSBpZiAoaW52ZXJzZSA9PT0gbnVsbCkge1xuICAgICAgbmFtZWRCbG9ja3MgPSBbWydkZWZhdWx0J10sIFtibG9ja3NbdGVtcGxhdGVdXV07XG4gICAgfSBlbHNlIHtcbiAgICAgIG5hbWVkQmxvY2tzID0gW1snZGVmYXVsdCcsICdlbHNlJ10sIFtibG9ja3NbdGVtcGxhdGVdLCBibG9ja3NbaW52ZXJzZV1dXTtcbiAgICB9XG5cbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLkJsb2NrLCBuYW1lLCBwYXJhbXMsIGhhc2gsIG5hbWVkQmxvY2tzXSk7XG4gIH1cblxuICBvcGVuQ29tcG9uZW50KGVsZW1lbnQ6IEFTVC5FbGVtZW50Tm9kZSkge1xuICAgIGxldCB0YWcgPVxuICAgICAgdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy5jdXN0b21pemVDb21wb25lbnROYW1lXG4gICAgICAgID8gdGhpcy5vcHRpb25zLmN1c3RvbWl6ZUNvbXBvbmVudE5hbWUoZWxlbWVudC50YWcpXG4gICAgICAgIDogZWxlbWVudC50YWc7XG4gICAgbGV0IGNvbXBvbmVudCA9IG5ldyBDb21wb25lbnRCbG9jayh0YWcsIGVsZW1lbnQuc3ltYm9scyEsIGVsZW1lbnQuc2VsZkNsb3NpbmcpO1xuICAgIHRoaXMuYmxvY2tzLnB1c2goY29tcG9uZW50KTtcbiAgfVxuXG4gIG9wZW5OYW1lZEJsb2NrKGVsZW1lbnQ6IEFTVC5FbGVtZW50Tm9kZSkge1xuICAgIGxldCBibG9jazogQmxvY2sgPSBuZXcgTmFtZWRCbG9jayhlbGVtZW50LnRhZywgZWxlbWVudC5zeW1ib2xzISk7XG4gICAgdGhpcy5ibG9ja3MucHVzaChibG9jayk7XG4gIH1cblxuICBvcGVuRWxlbWVudChbZWxlbWVudCwgc2ltcGxlXTogW0FTVC5FbGVtZW50Tm9kZSwgYm9vbGVhbl0pIHtcbiAgICBsZXQgdGFnID0gZWxlbWVudC50YWc7XG5cbiAgICBpZiAoZWxlbWVudC5ibG9ja1BhcmFtcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDb21waWxlIEVycm9yOiA8JHtlbGVtZW50LnRhZ30+IGlzIG5vdCBhIGNvbXBvbmVudCBhbmQgZG9lc24ndCBzdXBwb3J0IGJsb2NrIHBhcmFtZXRlcnNgXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLk9wZW5FbGVtZW50LCB0YWcsIHNpbXBsZV0pO1xuICAgIH1cbiAgfVxuXG4gIGZsdXNoRWxlbWVudCgpIHtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLkZsdXNoRWxlbWVudF0pO1xuICB9XG5cbiAgY2xvc2VDb21wb25lbnQoX2VsZW1lbnQ6IEFTVC5FbGVtZW50Tm9kZSkge1xuICAgIGxldCBbdGFnLCBhdHRycywgYXJncywgYmxvY2tzXSA9IHRoaXMuZW5kQ29tcG9uZW50KCk7XG5cbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLkNvbXBvbmVudCwgdGFnLCBhdHRycywgYXJncywgYmxvY2tzXSk7XG4gIH1cblxuICBjbG9zZU5hbWVkQmxvY2soX2VsZW1lbnQ6IEFTVC5FbGVtZW50Tm9kZSkge1xuICAgIGxldCB7IGJsb2NrcyB9ID0gdGhpcztcbiAgICBsZXQgYmxvY2sgPSBleHBlY3QoYmxvY2tzLnBvcCgpLCBgRXhwZWN0ZWQgYSBuYW1lZCBibG9jayBvbiB0aGUgc3RhY2tgKSBhcyBOYW1lZEJsb2NrO1xuXG4gICAgdGhpcy5jdXJyZW50Q29tcG9uZW50LnB1c2hCbG9jayhibG9jay5uYW1lLCBibG9jay50b0pTT04oKSk7XG4gIH1cblxuICBjbG9zZUR5bmFtaWNDb21wb25lbnQoX2VsZW1lbnQ6IEFTVC5FbGVtZW50Tm9kZSkge1xuICAgIGxldCBbLCBhdHRycywgYXJncywgYmxvY2tdID0gdGhpcy5lbmRDb21wb25lbnQoKTtcblxuICAgIHRoaXMucHVzaChbU2V4cE9wY29kZXMuRHluYW1pY0NvbXBvbmVudCwgdGhpcy5wb3BWYWx1ZTxFeHByZXNzaW9uPigpLCBhdHRycywgYXJncywgYmxvY2tdKTtcbiAgfVxuXG4gIGNsb3NlRWxlbWVudChfZWxlbWVudDogQVNULkVsZW1lbnROb2RlKSB7XG4gICAgdGhpcy5wdXNoKFtTZXhwT3Bjb2Rlcy5DbG9zZUVsZW1lbnRdKTtcbiAgfVxuXG4gIHN0YXRpY0F0dHIoW25hbWUsIG5hbWVzcGFjZV06IFtzdHJpbmcsIE9wdGlvbjxzdHJpbmc+XSkge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWU8c3RyaW5nPigpO1xuICAgIHRoaXMucHVzaChbU2V4cE9wY29kZXMuU3RhdGljQXR0ciwgbmFtZSwgdmFsdWUsIG5hbWVzcGFjZV0pO1xuICB9XG5cbiAgZHluYW1pY0F0dHIoW25hbWUsIG5hbWVzcGFjZV06IFtzdHJpbmcsIE9wdGlvbjxzdHJpbmc+XSkge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWU8RXhwcmVzc2lvbj4oKTtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLkR5bmFtaWNBdHRyLCBuYW1lLCB2YWx1ZSwgbmFtZXNwYWNlXSk7XG4gIH1cblxuICBjb21wb25lbnRBdHRyKFtuYW1lLCBuYW1lc3BhY2VdOiBbc3RyaW5nLCBPcHRpb248c3RyaW5nPl0pIHtcbiAgICBsZXQgdmFsdWUgPSB0aGlzLnBvcFZhbHVlPEV4cHJlc3Npb24+KCk7XG4gICAgdGhpcy5wdXNoKFtTZXhwT3Bjb2Rlcy5Db21wb25lbnRBdHRyLCBuYW1lLCB2YWx1ZSwgbmFtZXNwYWNlXSk7XG4gIH1cblxuICB0cnVzdGluZ0F0dHIoW25hbWUsIG5hbWVzcGFjZV06IFtzdHJpbmcsIE9wdGlvbjxzdHJpbmc+XSkge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWU8RXhwcmVzc2lvbj4oKTtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLlRydXN0aW5nRHluYW1pY0F0dHIsIG5hbWUsIHZhbHVlLCBuYW1lc3BhY2UhXSk7XG4gIH1cblxuICB0cnVzdGluZ0NvbXBvbmVudEF0dHIoW25hbWUsIG5hbWVzcGFjZV06IFtzdHJpbmcsIE9wdGlvbjxzdHJpbmc+XSkge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWU8RXhwcmVzc2lvbj4oKTtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLlRydXN0aW5nQ29tcG9uZW50QXR0ciwgbmFtZSwgdmFsdWUsIG5hbWVzcGFjZSFdKTtcbiAgfVxuXG4gIHN0YXRpY0FyZyhuYW1lOiBzdHIpIHtcbiAgICBsZXQgdmFsdWUgPSB0aGlzLnBvcFZhbHVlPEV4cHJlc3Npb24+KCk7XG4gICAgdGhpcy5wdXNoKFtTZXhwT3Bjb2Rlcy5TdGF0aWNBcmcsIG5hbWUsIHZhbHVlXSk7XG4gIH1cblxuICBkeW5hbWljQXJnKG5hbWU6IHN0cikge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWU8RXhwcmVzc2lvbj4oKTtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLkR5bmFtaWNBcmcsIG5hbWUsIHZhbHVlXSk7XG4gIH1cblxuICB5aWVsZCh0bzogbnVtYmVyKSB7XG4gICAgbGV0IHBhcmFtcyA9IHRoaXMucG9wVmFsdWU8UGFyYW1zPigpO1xuICAgIHRoaXMucHVzaChbU2V4cE9wY29kZXMuWWllbGQsIHRvLCBwYXJhbXNdKTtcbiAgfVxuXG4gIGF0dHJTcGxhdCh0bzogT3B0aW9uPG51bWJlcj4pIHtcbiAgICAvLyBjb25zdW1lIChhbmQgZGlzcmVnYXJkKSB0aGUgdmFsdWUgcHVzaGVkIGZvciB0aGVcbiAgICAvLyAuLi5hdHRyaWJ1dGVzIGF0dHJpYnV0ZVxuICAgIHRoaXMucG9wVmFsdWUoKTtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLkF0dHJTcGxhdCwgdG8hXSk7XG4gIH1cblxuICBkZWJ1Z2dlcihldmFsSW5mbzogT3B0aW9uPENvcmUuRXZhbEluZm8+KSB7XG4gICAgdGhpcy5wdXNoKFtTZXhwT3Bjb2Rlcy5EZWJ1Z2dlciwgZXZhbEluZm8hXSk7XG4gICAgdGhpcy50ZW1wbGF0ZS5ibG9jay5oYXNFdmFsID0gdHJ1ZTtcbiAgfVxuXG4gIGhhc0Jsb2NrKG5hbWU6IG51bWJlcikge1xuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLkhhc0Jsb2NrPihbU2V4cE9wY29kZXMuSGFzQmxvY2ssIG5hbWVdKTtcbiAgfVxuXG4gIGhhc0Jsb2NrUGFyYW1zKG5hbWU6IG51bWJlcikge1xuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLkhhc0Jsb2NrUGFyYW1zPihbU2V4cE9wY29kZXMuSGFzQmxvY2tQYXJhbXMsIG5hbWVdKTtcbiAgfVxuXG4gIHBhcnRpYWwoZXZhbEluZm86IE9wdGlvbjxDb3JlLkV2YWxJbmZvPikge1xuICAgIGxldCBwYXJhbXMgPSB0aGlzLnBvcFZhbHVlPFBhcmFtcz4oKTtcbiAgICB0aGlzLnB1c2goW1NleHBPcGNvZGVzLlBhcnRpYWwsIHBhcmFtc1swXSwgZXZhbEluZm8hXSk7XG4gICAgdGhpcy50ZW1wbGF0ZS5ibG9jay5oYXNFdmFsID0gdHJ1ZTtcbiAgfVxuXG4gIC8vLyBFeHByZXNzaW9uc1xuXG4gIGxpdGVyYWwodmFsdWU6IEV4cHJlc3Npb25zLlZhbHVlIHwgdW5kZWZpbmVkKSB7XG4gICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLlVuZGVmaW5lZD4oW1NleHBPcGNvZGVzLlVuZGVmaW5lZF0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnB1c2hWYWx1ZTxFeHByZXNzaW9ucy5WYWx1ZT4odmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIHVua25vd24obmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5wdXNoVmFsdWU8RXhwcmVzc2lvbnMuVW5rbm93bj4oW1NleHBPcGNvZGVzLlVua25vd24sIG5hbWVdKTtcbiAgfVxuXG4gIGdldChbaGVhZCwgcGF0aF06IFtudW1iZXIsIHN0cmluZ1tdXSkge1xuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLkdldD4oW1NleHBPcGNvZGVzLkdldCwgaGVhZCwgcGF0aF0pO1xuICB9XG5cbiAgbWF5YmVMb2NhbChwYXRoOiBzdHJpbmdbXSkge1xuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLk1heWJlTG9jYWw+KFtTZXhwT3Bjb2Rlcy5NYXliZUxvY2FsLCBwYXRoXSk7XG4gIH1cblxuICBjb25jYXQoKSB7XG4gICAgdGhpcy5wdXNoVmFsdWU8RXhwcmVzc2lvbnMuQ29uY2F0PihbU2V4cE9wY29kZXMuQ29uY2F0LCB0aGlzLnBvcFZhbHVlPFBhcmFtcz4oKV0pO1xuICB9XG5cbiAgaGVscGVyKG5hbWU6IHN0cmluZykge1xuICAgIGxldCBwYXJhbXMgPSB0aGlzLnBvcFZhbHVlPFBhcmFtcz4oKTtcbiAgICBsZXQgaGFzaCA9IHRoaXMucG9wVmFsdWU8SGFzaD4oKTtcblxuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLkhlbHBlcj4oW1NleHBPcGNvZGVzLkhlbHBlciwgbmFtZSwgcGFyYW1zLCBoYXNoXSk7XG4gIH1cblxuICAvLy8gU3RhY2sgTWFuYWdlbWVudCBPcGNvZGVzXG5cbiAgcHJlcGFyZUFycmF5KHNpemU6IG51bWJlcikge1xuICAgIGxldCB2YWx1ZXM6IEV4cHJlc3Npb25bXSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICAgIHZhbHVlcy5wdXNoKHRoaXMucG9wVmFsdWUoKSBhcyBFeHByZXNzaW9uKTtcbiAgICB9XG5cbiAgICB0aGlzLnB1c2hWYWx1ZTxQYXJhbXM+KHZhbHVlcyk7XG4gIH1cblxuICBwcmVwYXJlT2JqZWN0KHNpemU6IG51bWJlcikge1xuICAgIGFzc2VydChcbiAgICAgIHRoaXMudmFsdWVzLmxlbmd0aCA+PSBzaXplLFxuICAgICAgYEV4cGVjdGVkICR7c2l6ZX0gdmFsdWVzIG9uIHRoZSBzdGFjaywgZm91bmQgJHt0aGlzLnZhbHVlcy5sZW5ndGh9YFxuICAgICk7XG5cbiAgICBsZXQga2V5czogc3RyaW5nW10gPSBuZXcgQXJyYXkoc2l6ZSk7XG4gICAgbGV0IHZhbHVlczogRXhwcmVzc2lvbltdID0gbmV3IEFycmF5KHNpemUpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICAgIGtleXNbaV0gPSB0aGlzLnBvcFZhbHVlPHN0cj4oKTtcbiAgICAgIHZhbHVlc1tpXSA9IHRoaXMucG9wVmFsdWU8RXhwcmVzc2lvbj4oKTtcbiAgICB9XG5cbiAgICB0aGlzLnB1c2hWYWx1ZTxIYXNoPihba2V5cywgdmFsdWVzXSk7XG4gIH1cblxuICAvLy8gVXRpbGl0aWVzXG5cbiAgZW5kQ29tcG9uZW50KCk6IFtzdHJpbmcsIFN0YXRlbWVudHMuQXR0cmlidXRlW10sIENvcmUuSGFzaCwgQ29yZS5CbG9ja3NdIHtcbiAgICBsZXQgY29tcG9uZW50ID0gdGhpcy5ibG9ja3MucG9wKCk7XG4gICAgYXNzZXJ0KFxuICAgICAgY29tcG9uZW50IGluc3RhbmNlb2YgQ29tcG9uZW50QmxvY2ssXG4gICAgICAnQ29tcGlsZXIgYnVnOiBlbmRDb21wb25lbnQoKSBzaG91bGQgZW5kIGEgY29tcG9uZW50J1xuICAgICk7XG5cbiAgICByZXR1cm4gKGNvbXBvbmVudCBhcyBDb21wb25lbnRCbG9jaykudG9KU09OKCk7XG4gIH1cblxuICBzdGFydElubGluZUJsb2NrKHN5bWJvbHM6IEFTVC5CbG9ja1N5bWJvbHMpIHtcbiAgICBsZXQgYmxvY2s6IEJsb2NrID0gbmV3IElubGluZUJsb2NrKHN5bWJvbHMpO1xuICAgIHRoaXMuYmxvY2tzLnB1c2goYmxvY2spO1xuICB9XG5cbiAgZW5kSW5saW5lQmxvY2soKTogU2VyaWFsaXplZElubGluZUJsb2NrIHtcbiAgICBsZXQgeyBibG9ja3MgfSA9IHRoaXM7XG4gICAgbGV0IGJsb2NrID0gYmxvY2tzLnBvcCgpIGFzIElubGluZUJsb2NrO1xuICAgIHJldHVybiBibG9jay50b0pTT04oKTtcbiAgfVxuXG4gIHB1c2goYXJnczogU3RhdGVtZW50KSB7XG4gICAgdGhpcy5jdXJyZW50QmxvY2sucHVzaChhcmdzKTtcbiAgfVxuXG4gIHB1c2hWYWx1ZTxTIGV4dGVuZHMgRXhwcmVzc2lvbiB8IFBhcmFtcyB8IEhhc2g+KHZhbDogUykge1xuICAgIHRoaXMudmFsdWVzLnB1c2godmFsKTtcbiAgfVxuXG4gIHBvcFZhbHVlPFQgZXh0ZW5kcyBTdGFja1ZhbHVlPigpOiBUIHtcbiAgICBhc3NlcnQodGhpcy52YWx1ZXMubGVuZ3RoLCAnTm8gZXhwcmVzc2lvbiBmb3VuZCBvbiBzdGFjaycpO1xuICAgIHJldHVybiB0aGlzLnZhbHVlcy5wb3AoKSBhcyBUO1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9